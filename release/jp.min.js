var __extends=this&&this.__extends||function(a){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b;}||function(c,b){for(var a in b)b.hasOwnProperty(a)&&(c[a]=b[a]);},function(c,b){function d(){this.constructor=c;}a(c,b),c.prototype=b===null?Object.create(b):(d.prototype=b.prototype,new d());};}();var KEY_LEFT=37;var KEY_UP=38;var KEY_RIGHT=39;var KEY_DOWN=40;var KEY_SPACE=32;var REPLACE_R=153;var REPLACE_G=153;var REPLACE_B=153;var ENEMY_TYPE_UFO=0;var ENEMY_TYPE_UFO_BLUE=1;var ENEMY_TYPE_UFO_YELLOW=2;var ENEMY_TYPE_UFO_ORANGE=3;var ENEMY_TYPE_SHOOTER=4;var ENEMY_TYPE_SHOOTER_BLUE=5;var ENEMY_TYPE_DIAMOND=6;var ENEMY_TYPE_DIAMOND_BLUE=7;var ENEMY_TYPE_DIAMOND_YELLOW=8;var ATTACK_VECTORS=[[1920,100,100,580,1820,580,100,1080],[1920,980,100,500,1820,500,100,0],[1920,100,0,100],[1920,500,0,500],[1920,950,0,950],[1920,100,1800,100,1800,950,1800,100,0,100],[1920,950,1600,950,1600,100,1600,950,0,950],[1920,100,1300,950,1000,100,800,950,400,100,0,950],[1920,950,1400,100,1100,950,900,100,500,950,0,100],[1920,100,1000,950,0,100],[1920,950,1000,100,0,950],[0,100,1920,100],[0,500,1920,500],[0,950,1920,950]];var SQUADS=[[20,ENEMY_TYPE_UFO,2,ENEMY_TYPE_UFO,2,ENEMY_TYPE_UFO_BLUE,2],[20,ENEMY_TYPE_UFO,3,ENEMY_TYPE_UFO,3,ENEMY_TYPE_UFO_BLUE,3],[20,ENEMY_TYPE_UFO,4,ENEMY_TYPE_UFO,4,ENEMY_TYPE_UFO_BLUE,4],[0,ENEMY_TYPE_UFO,2,ENEMY_TYPE_UFO,3,ENEMY_TYPE_UFO_BLUE,4],[0,ENEMY_TYPE_UFO_BLUE,2,ENEMY_TYPE_UFO,3,ENEMY_TYPE_UFO,4],[0,ENEMY_TYPE_UFO,2,ENEMY_TYPE_UFO_BLUE,3,ENEMY_TYPE_UFO,4],[30,ENEMY_TYPE_UFO,1,ENEMY_TYPE_UFO,1,ENEMY_TYPE_UFO_BLUE,1],[30,ENEMY_TYPE_UFO,0,ENEMY_TYPE_UFO,0,ENEMY_TYPE_UFO_BLUE,0],[0,ENEMY_TYPE_SHOOTER,5,ENEMY_TYPE_SHOOTER,6],[20,ENEMY_TYPE_SHOOTER,2,ENEMY_TYPE_SHOOTER,3,ENEMY_TYPE_SHOOTER,4],[20,ENEMY_TYPE_UFO,5,ENEMY_TYPE_UFO,5,ENEMY_TYPE_UFO,5,ENEMY_TYPE_UFO_BLUE,5,ENEMY_TYPE_SHOOTER,5],[50,ENEMY_TYPE_DIAMOND,3,ENEMY_TYPE_DIAMOND,4,ENEMY_TYPE_DIAMOND,2],[50,ENEMY_TYPE_DIAMOND,4,ENEMY_TYPE_DIAMOND,2,ENEMY_TYPE_DIAMOND,3],[30,ENEMY_TYPE_UFO_YELLOW,7,ENEMY_TYPE_UFO_YELLOW,7,ENEMY_TYPE_UFO_YELLOW,7,ENEMY_TYPE_UFO_YELLOW,7,ENEMY_TYPE_UFO_YELLOW,7,ENEMY_TYPE_DIAMOND_BLUE,7],[30,ENEMY_TYPE_UFO_YELLOW,8,ENEMY_TYPE_UFO_YELLOW,8,ENEMY_TYPE_UFO_YELLOW,8,ENEMY_TYPE_UFO_YELLOW,8,ENEMY_TYPE_UFO_YELLOW,8,ENEMY_TYPE_DIAMOND_BLUE,8],[30,ENEMY_TYPE_UFO_YELLOW,9,ENEMY_TYPE_UFO_YELLOW,9,ENEMY_TYPE_UFO_YELLOW,9,ENEMY_TYPE_UFO_YELLOW,9,ENEMY_TYPE_UFO_YELLOW,9,ENEMY_TYPE_DIAMOND_BLUE,9],[30,ENEMY_TYPE_UFO_YELLOW,10,ENEMY_TYPE_UFO_YELLOW,10,ENEMY_TYPE_UFO_YELLOW,10,ENEMY_TYPE_UFO_YELLOW,10,ENEMY_TYPE_UFO_YELLOW,10,ENEMY_TYPE_DIAMOND_BLUE,10],[50,ENEMY_TYPE_DIAMOND_BLUE,0,ENEMY_TYPE_DIAMOND,0,ENEMY_TYPE_DIAMOND,0],[50,ENEMY_TYPE_DIAMOND_YELLOW,1,ENEMY_TYPE_DIAMOND,1,ENEMY_TYPE_DIAMOND,1],[0,ENEMY_TYPE_UFO_YELLOW,11,ENEMY_TYPE_UFO_YELLOW,12,ENEMY_TYPE_UFO_YELLOW,13],[0,ENEMY_TYPE_UFO_YELLOW,2,ENEMY_TYPE_UFO_YELLOW,3,ENEMY_TYPE_UFO_YELLOW,4],[30,ENEMY_TYPE_SHOOTER_BLUE,7,ENEMY_TYPE_SHOOTER,7,ENEMY_TYPE_SHOOTER,7,ENEMY_TYPE_SHOOTER,7,ENEMY_TYPE_SHOOTER,7,ENEMY_TYPE_SHOOTER,7],[30,ENEMY_TYPE_SHOOTER_BLUE,10,ENEMY_TYPE_SHOOTER,10,ENEMY_TYPE_SHOOTER,10,ENEMY_TYPE_SHOOTER,10,ENEMY_TYPE_SHOOTER,10,ENEMY_TYPE_SHOOTER,10],[50,ENEMY_TYPE_DIAMOND_YELLOW,1,ENEMY_TYPE_DIAMOND_YELLOW,1,ENEMY_TYPE_DIAMOND_YELLOW,1],[50,ENEMY_TYPE_UFO_ORANGE,8,ENEMY_TYPE_UFO_ORANGE,8,ENEMY_TYPE_UFO_ORANGE,8],[50,ENEMY_TYPE_UFO_ORANGE,9,ENEMY_TYPE_UFO_ORANGE,9,ENEMY_TYPE_UFO_ORANGE,9,ENEMY_TYPE_DIAMOND_YELLOW,9],[0,ENEMY_TYPE_UFO_ORANGE,2,ENEMY_TYPE_UFO_ORANGE,12,ENEMY_TYPE_UFO_ORANGE,4,ENEMY_TYPE_DIAMOND_YELLOW,7],[10,ENEMY_TYPE_UFO_ORANGE,3,ENEMY_TYPE_UFO_ORANGE,3,ENEMY_TYPE_DIAMOND_YELLOW,3,ENEMY_TYPE_UFO_BLUE,3],[10,ENEMY_TYPE_UFO_ORANGE,2,ENEMY_TYPE_UFO_ORANGE,2,ENEMY_TYPE_DIAMOND_YELLOW,2,ENEMY_TYPE_UFO_BLUE,2],[10,ENEMY_TYPE_UFO_ORANGE,4,ENEMY_TYPE_UFO_ORANGE,4,ENEMY_TYPE_DIAMOND_YELLOW,4,ENEMY_TYPE_UFO_BLUE,4]];var AttackPatternBuilder=function(){function a(){this.pattern=[],this.curTime=0,this.skip=0,this.addSquads(),this.pattern.sort(this.compare);}return a.prototype.addSquads=function(){this.addSquad(0,0),this.addSquad(200,2),this.addSquad(200,1),this.addSquad(200,3),this.addSquad(200,5),this.addSquad(200,4),this.addSquad(200,6),this.addSquad(200,7),this.addSquad(200,6),this.addSquad(200,7),this.addSquad(200,6),this.addSquad(0,7),this.addSquad(300,10),this.addSquad(200,9),this.addSquad(200,8),this.addSquad(100,8),this.addSquad(200,9),this.addSquad(300,10),this.addSquad(300,11),this.addSquad(300,12),this.addSquad(300,13),this.addSquad(300,12),this.addSquad(300,14),this.addSquad(300,11),this.addSquad(300,15),this.addSquad(300,12),this.addSquad(300,16),this.addSquad(300,17),this.addSquad(300,18),this.addSquad(300,20),this.addSquad(300,19);for(var a=0;a<20;a++)this.addSquad(10+Math.floor(Math.random()*300),5+Math.floor(Math.random()*15));this.addSquad(300,21),this.addSquad(300,22),this.addSquad(300,23),this.addSquad(300,24),this.addSquad(300,25),this.addSquad(300,26),this.addSquad(300,27),this.addSquad(300,28),this.addSquad(300,29);for(var a=0;a<100;a++)this.addSquad(10+Math.floor(Math.random()*300),10+Math.floor(Math.random()*(SQUADS.length-11)));},a.prototype.skipHere=function(){this.skip=this.pattern.length;},a.prototype.addSquad=function(g,b){this.curTime+=g;var c=(SQUADS[b].length-1)/2;var d=SQUADS[b][0];for(var a=0;a<c;a++){var e=SQUADS[b][1+a*2];var f=SQUADS[b][1+a*2+1];this.pattern.push([this.curTime+d*a,e,f]);}},a.prototype.compare=function(a,b){return a[0]-b[0];},a;}();var Point=function(){function a(a,b){this.x=a,this.y=b;}return a;}();var Sprite=function(){function a(a,b){this.pos=new Point(a,b),this.srcX=0,this.srcY=0,this.width=64,this.height=64,this.alpha=1,this.visible=!0,this.scale=1;}return a.prototype.draw=function(b,a){if(!this.visible||this.alpha==0)return;a.globalAlpha=this.alpha,a.drawImage(b,this.srcX,this.srcY,this.width,this.height,this.pos.x-this.width/2*this.scale,this.pos.y-this.height/2*this.scale,this.width*this.scale,this.height*this.scale);},a;}();var Engine=function(){function a(a,b){this.frame=0,this.spriteCanvas=a,this.drawCanvas=b,this.spriteCanvasCtx=a.getContext('2d'),this.drawCanvasCtx=b.getContext('2d'),this.sprites=[],this.trackedKeys=[],this.recolorCopy(this.spriteCanvasCtx,256,0,128,128,[{r:85,g:153,b:255},{r:255,g:204,b:0},{r:255,g:100,b:55}]),this.recolorCopy(this.spriteCanvasCtx,512,0,64,256,[{r:85,g:153,b:255}]),this.recolorCopy(this.spriteCanvasCtx,576,0,128,256,[{r:85,g:153,b:255},{r:255,g:204,b:0}]),this.recolorCopy(this.spriteCanvasCtx,448,0,64,64,[{r:255,g:204,b:0},{r:42,g:170,b:255},{r:0,g:190,b:0},{r:255,g:255,b:255}]),document.onkeydown=this.keyDown.bind(this),document.onkeyup=this.keyUp.bind(this),this.game=new Game(this),this.game.initialize(),requestAnimationFrame(this.loop.bind(this));}return a.prototype.keyDown=function(a){a=a||window.event,this.trackedKeys[a.keyCode]=!0;},a.prototype.keyUp=function(a){a=a||window.event,this.trackedKeys[a.keyCode]=!1;},a.prototype.isKeyDown=function(a){return this.trackedKeys[a];},a.prototype.loop=function(){this.frame++,this.drawCanvasCtx.globalAlpha=1,this.drawCanvasCtx.fillStyle='#000000',this.drawCanvasCtx.fillRect(0,0,this.drawCanvas.width,this.drawCanvas.height),this.game.update(this.frame);for(var a=0,b=this.sprites;a<b.length;a++){var c=b[a];c.draw(this.spriteCanvas,this.drawCanvasCtx);}requestAnimationFrame(this.loop.bind(this));},a.prototype.getWidth=function(){return this.drawCanvas.width;},a.prototype.getHeight=function(){return this.drawCanvas.height;},a.prototype.createSprite=function(b,c){var a=new Sprite(b,c);return this.sprites.push(a),a;},a.prototype.bringSpriteToFront=function(a){this.sprites.splice(this.sprites.indexOf(a),1),this.sprites.push(a);},a.prototype.bringSpriteToBack=function(a){this.sprites.splice(this.sprites.indexOf(a),1),this.sprites.unshift(a);},a.prototype.recolorCopy=function(e,f,g,i,h,d){for(var c=0;c<d.length;c++){var a=e.getImageData(f,g,i,h);for(var b=0;b<a.data.length;b+=4)a.data[b]===REPLACE_R&&a.data[b+1]===REPLACE_G&&a.data[b+2]===REPLACE_B&&(a.data[b]=d[c].r,a.data[b+1]=d[c].g,a.data[b+2]=d[c].b);e.putImageData(a,f,g+h*(c+1));}},a;}();window.onload=function(){var a=new Image();a.onload=function(){document.getElementById('sprites').getContext('2d').drawImage(a,0,0),new Engine(document.getElementById('sprites'),document.getElementById('draw'));},a.src='sprites.svg';};var Logo=function(){function a(a){this.sprite=a.createSprite(0,0),this.sprite.srcX=0,this.sprite.srcY=768,this.sprite.width=640,this.sprite.height=256;}return a.prototype.setToRestart=function(){this.sprite.srcY=512,this.sprite.width=552;},a.prototype.hide=function(){return window.location.href.indexOf('quick')>-1&&(this.sprite.alpha=0),this.sprite.scale-=0.001,this.sprite.alpha-=0.01,this.sprite.alpha<0&&(this.sprite.alpha=0),this.sprite.alpha==0;},a.prototype.show=function(a){this.sprite.alpha=1,this.sprite.scale=1,this.sprite.pos.x=a.getWidth()/2,this.sprite.pos.y=a.getHeight()/2,a.bringSpriteToFront(this.sprite);},a.prototype.blendIn=function(){return this.sprite.alpha+=0.01,this.sprite.alpha>1&&(this.sprite.alpha=1),this.sprite.alpha==1;},a;}();var GameObject=function(){function a(a,b,c){this.sprite=a.createSprite(b,c),this.speed=new Point(0,0);}return a.prototype.update=function(a){this.sprite.pos.x+=this.speed.x,this.sprite.pos.y+=this.speed.y;},a.prototype.updateHideAfter=function(){this.hideAfter>0&&(this.hideAfter--,this.hideAfter==0&&(this.sprite.visible=!1));},a.prototype.kill=function(a){this.hideAfter=a,this.hp=0,a==0&&(this.sprite.visible=!1);},a;}();var Player=function(b){function a(c,d,e){var a=b.call(this,c,d,e)||this;return a.engine=c,a.sprite.srcX=0,a.sprite.srcY=0,a.sprite.width=128,a.sprite.height=128,a.breakBetweenShots=5,a.lastShotTime=0,a.bestPoints=0,a.hp=1,a.reset(),a.shieldSprite=new Sprite(0,0),a.shieldSprite.visible=!1,a.engine.sprites.push(a.shieldSprite),a.shieldSprite.srcX=0,a.shieldSprite.srcY=128,a.shieldSprite.width=192,a.shieldSprite.height=192,a;}return __extends(a,b),a.prototype.shoot=function(c,d){if(this.hp<1)return;if(c-this.lastShotTime>this.breakBetweenShots){for(var b=0;b<this.shotsPerShot;b++){var a=0;this.shots++,this.spreadShots&&(this.shots%3==0&&(a=4),this.shots%3==1&&(a=-4)),d.shoot(this.sprite.pos.x+30,this.sprite.pos.y+20,25,a,200,0);}for(var b=0;b<this.backShotsPerShot;b++){var a=0;this.bshots++,this.spreadShots&&(this.bshots%3==0&&(a=4),this.bshots%3==1&&(a=-4)),d.shoot(this.sprite.pos.x+30,this.sprite.pos.y+20,-25,a,200,0);}this.lastShotTime=c,globalGame.playShotSound();}},a.prototype.update=function(a){b.prototype.update.call(this,a),this.shieldSprite.pos.x=this.sprite.pos.x,this.shieldSprite.pos.y=this.sprite.pos.y,this.shieldSprite.visible=this.shield,this.shieldSprite.alpha=0.75+Math.sin(a/10)*0.25,this.sprite.pos.x>this.engine.getWidth()-this.sprite.width/2&&(this.sprite.pos.x=this.engine.getWidth()-this.sprite.width/2),this.sprite.pos.x<this.sprite.width/2&&(this.sprite.pos.x=this.sprite.width/2),this.sprite.pos.y>this.engine.getHeight()-this.sprite.height/2&&(this.sprite.pos.y=this.engine.getHeight()-this.sprite.height/2),this.sprite.pos.y<this.sprite.height/2&&(this.sprite.pos.y=this.sprite.height/2);},a.prototype.takeDamage=function(a){return this.shield?(this.shield=!1,globalGame.speak('shield lost'),!0):(this.hp>0&&(this.hp-=a,this.hp<=0&&(this.kill(70),this.sprite.visible=!0,this.engine.bringSpriteToBack(this.sprite),globalGame.explosionManager.explode(70,this.sprite.pos.x,this.sprite.pos.y,128,128,3),globalGame.speak('hull integrity zero percent'))),!1);},a.prototype.reset=function(){this.hp=1,this.sprite.visible=!0,this.sprite.pos.x=100,this.sprite.pos.y=this.engine.getHeight()/2,this.spreadShots=!1,this.breakBetweenShots=20,this.shield=!1,this.weaponUpgrade=0,this.speedUpgrade=0,this.shotsPerShot=1,this.backShotsPerShot=0,this.points>this.bestPoints&&(this.bestPoints=this.points,globalGame.speak('the new top score is '+this.bestPoints+' points')),this.points=0,this.shots=0,this.bshots=0;},a.prototype.upgradeWeapon=function(){this.weaponUpgrade+=1,this.points+=50,this.weaponUpgrade<=7&&globalGame.speak('weapon systems improved!'),this.weaponUpgrade==1&&(this.breakBetweenShots=13),this.weaponUpgrade==2&&(this.spreadShots=!0),this.weaponUpgrade==3&&(this.breakBetweenShots=10,this.backShotsPerShot=1),this.weaponUpgrade==4&&(this.shotsPerShot=2,this.backShotsPerShot=2),this.weaponUpgrade==5&&(this.shotsPerShot=3),this.weaponUpgrade==6&&(this.backShotsPerShot=3,this.breakBetweenShots=8),this.weaponUpgrade==7&&(this.breakBetweenShots=9);},a.prototype.upgradeShield=function(){this.points+=50,this.shield||globalGame.speak('shield activated!'),this.shield=!0;},a.prototype.upgradeSpeed=function(){this.points+=50,globalGame.speak('speed increased!'),this.speedUpgrade+=0.2;},a.prototype.givePoints=function(a){this.points+=a,globalGame.speak(a+' bonus points!');},a;}(GameObject);var Bullet=function(b){function a(c,d,e,f){var a=b.call(this,c,d,e)||this;return a.setType(f),a;}return __extends(a,b),a.prototype.update=function(a){b.prototype.update.call(this,a),this.lifetime>0&&this.lifetime--,this.lifetime==0&&this.kill(0);},a.prototype.setType=function(a){this.type=a,this.sprite.srcX=128,this.sprite.srcY=0,a==1&&(this.sprite.srcX=384),a==2&&(this.sprite.srcX=384,this.sprite.srcY=128);},a;}(GameObject);var BulletManager=function(){function a(c){this.bullets=[];for(var a=0;a<200;a++){var b=new Bullet(c.engine,0,0,0);this.bullets.push(b),b.kill(0);}}return a.prototype.getFirstDead=function(){for(var a=0,b=this.bullets;a<b.length;a++){var c=b[a];if(c.hp==0)return c;}return null;},a.prototype.shoot=function(b,c,d,e,f,g){var a=this.getFirstDead();a!=null&&(a.lifetime=f,a.sprite.pos.x=b,a.sprite.pos.y=c,a.speed.x=d,a.speed.y=e,a.hp=1,a.sprite.visible=!0,a.setType(g));},a.prototype.reset=function(){for(var a=0,b=this.bullets;a<b.length;a++){var c=b[a];c.kill(0);}},a.prototype.update=function(i,j,h){for(var c=0,e=this.bullets;c<e.length;c++){var a=e[c];if(a.update(i),a.hp>0&&a.type>0&&Game.distnaceCheck(a.sprite,h.sprite,72)&&(h.takeDamage(1),a.kill(0)),a.hp>0&&a.type==0)for(var d=0,f=j.enemies;d<f.length;d++){var b=f[d];if(b.hp>0&&Game.spritesIntersect(a.sprite,b.sprite)&&(b.takeDamage(1),b.hp<=0&&globalGame.goodieManager.dropGoodie(b.type,b.sprite.pos.x,b.sprite.pos.y),a.kill(0),globalGame.player.points+=10,Math.random()<0.025)){var g=Math.floor(Math.random()*5);switch(g){case 0:globalGame.speak('nice shot');break;case 1:globalGame.speak('clean kill');break;case 2:globalGame.speak('target destroyed');break;case 3:globalGame.speak('impressive targeting');break;case 4:globalGame.speak('outstanding aim');break;}}}}},a;}();var PARTICLE_BLUE=0;var PARTICLE_EXPLO=1;var Particle=function(b){function a(c,d,e,f){var a=b.call(this,c,d,e)||this;return a.sprite.width=64,a.sprite.height=64,a.reset(f),a;}return __extends(a,b),a.prototype.setType=function(a){a==PARTICLE_BLUE&&(this.sprite.srcX=128,this.sprite.srcY=64),a==PARTICLE_EXPLO&&(this.sprite.srcX=384,this.sprite.srcY=64);},a.prototype.reset=function(a){this.lifetime=a,this.maxLifetime=a,this.hp=1,this.sprite.visible=!0,this.sprite.alpha=1;},a.prototype.update=function(a){b.prototype.update.call(this,a),this.lifetime--,this.lifetime<0?this.kill(0):this.sprite.alpha=this.lifetime/this.maxLifetime;},a;}(GameObject);var ParticleManager=function(){function a(c){this.particles=[];for(var a=0;a<200;a++){var b=new Particle(c.engine,0,0,0);this.particles.push(b),b.kill(0);}}return a.prototype.getFirstDead=function(){for(var a=0,b=this.particles;a<b.length;a++){var c=b[a];if(c.hp==0)return c;}return null;},a.prototype.spawn=function(b,c,d,e,f,g){var a=this.getFirstDead();a!=null&&(a.reset(f),a.sprite.pos.x=b,a.sprite.pos.y=c,a.speed.x=d,a.speed.y=e,a.hp=1,a.sprite.visible=!0,a.setType(g));},a.prototype.update=function(d){for(var a=0,b=this.particles;a<b.length;a++){var c=b[a];c.hp>0&&c.update(d);}},a;}();var Enemy=function(b){function a(c){var a=b.call(this,c,0,0)||this;return a.sprite.visible=!1,a.hp=0,a.animOffset=Math.floor(Math.random()*100),a;}return __extends(a,b),a.prototype.setFrame=function(b){if(this.frame=b,this.type<=ENEMY_TYPE_UFO_ORANGE){var a=0;this.type==ENEMY_TYPE_UFO_BLUE&&(a=128),this.type==ENEMY_TYPE_UFO_YELLOW&&(a=256),this.type==ENEMY_TYPE_UFO_ORANGE&&(a=384),this.sprite.srcX=256,this.sprite.srcY=a,this.sprite.width=128,this.sprite.height=64,b==1&&(this.sprite.srcY=a+64);}else if(this.type<=ENEMY_TYPE_SHOOTER_BLUE){var a=0;this.type==ENEMY_TYPE_SHOOTER_BLUE&&(a=256),this.sprite.srcX=512,this.sprite.srcY=a,this.sprite.width=64,this.sprite.height=128,b==1&&(this.sprite.srcY=a+128);}else{var a=0;this.type==ENEMY_TYPE_DIAMOND_BLUE&&(a=256),this.type==ENEMY_TYPE_DIAMOND_YELLOW&&(a=512),this.sprite.srcX=576,this.sprite.srcY=a,this.sprite.width=128,this.sprite.height=128,b==1&&(this.sprite.srcY=a+128);}},a.prototype.spawn=function(b,a){this.type=b,this.attackVector=a,this.attackStep=0,this.attackSubStep=0,this.nextShot=10,this.hp=1,(this.type==ENEMY_TYPE_UFO_YELLOW||this.type==ENEMY_TYPE_DIAMOND||this.type==ENEMY_TYPE_DIAMOND_BLUE)&&(this.hp=4),(this.type==ENEMY_TYPE_UFO_ORANGE||this.type==ENEMY_TYPE_DIAMOND_YELLOW)&&(this.hp=8),this.attackSpeed=this.calcAttackSpeed(a[0],a[1],a[2],a[3]),this.setFrame(0),this.sprite.visible=!0,this.sprite.pos.x=a[0],this.sprite.pos.y=a[1],this.stop=!1;},a.prototype.calcAttackSpeed=function(a,b,c,d){return this.getSpeed()/(Math.abs(a-c)+Math.abs(b-d));},a.prototype.getSpeed=function(){return this.type==ENEMY_TYPE_SHOOTER?8:this.type==ENEMY_TYPE_UFO_YELLOW?12:this.type==ENEMY_TYPE_UFO_ORANGE||this.type==ENEMY_TYPE_DIAMOND_YELLOW?13:11;},a.prototype.update=function(j){if(b.prototype.update.call(this,j),this.stop||this.hp<=0)return;var f=!1;if(this.attackSubStep+=this.attackSpeed,this.attackSubStep>1&&(this.attackSubStep=0,this.attackStep++,f=!0),this.attackStep*2+2>=this.attackVector.length){this.kill(0);return;}var d=this.attackVector[this.attackStep*2];var e=this.attackVector[this.attackStep*2+1];var g=this.attackVector[this.attackStep*2+2];var h=this.attackVector[this.attackStep*2+3];if(f&&(this.attackSpeed=this.calcAttackSpeed(d,e,g,h)),this.sprite.pos.x=d+(g-d)*this.attackSubStep,this.sprite.pos.y=e+(h-e)*this.attackSubStep,(j+this.animOffset)%10==0&&this.setFrame((this.frame+1)%2),(this.type==ENEMY_TYPE_SHOOTER||this.type==ENEMY_TYPE_SHOOTER_BLUE)&&(this.nextShot--,this.nextShot<=0)&&(this.nextShot=45,this.type==ENEMY_TYPE_SHOOTER_BLUE&&(this.nextShot=30),globalGame.bulletManager.shoot(this.sprite.pos.x,this.sprite.pos.y-30,-15,0,200,1)),(this.type==ENEMY_TYPE_DIAMOND_BLUE||this.type==ENEMY_TYPE_DIAMOND_YELLOW||this.type==ENEMY_TYPE_DIAMOND)&&(this.nextShot--,this.nextShot<=0)){this.nextShot=60,this.type==ENEMY_TYPE_DIAMOND_BLUE&&(this.nextShot=45),this.type==ENEMY_TYPE_DIAMOND_YELLOW&&(this.nextShot=30);var a=globalGame.player.sprite.pos.x-this.sprite.pos.x;var c=globalGame.player.sprite.pos.y-this.sprite.pos.y;var i=Math.sqrt(Math.pow(a,2)+Math.pow(c,2));a=a/ i*15,c=c/ i*15,globalGame.bulletManager.shoot(this.sprite.pos.x,this.sprite.pos.y,a,c,200,2);}},a.prototype.takeDamage=function(a){this.hp-=a,this.hp<=0&&(this.kill(10),globalGame.engine.bringSpriteToBack(this.sprite),this.stop=!0,globalGame.explosionManager.explode(10,this.sprite.pos.x,this.sprite.pos.y,this.sprite.width,this.sprite.height,2));},a;}(GameObject);var EnemyManager=function(){function a(b,c){this.engine=b,this.gameObjects=c,this.enemies=[];var a=new AttackPatternBuilder();this.attackPattern=a.pattern,this.skip=a.skip,this.reset();}return a.prototype.reset=function(){if(this.currentAttack=0,this.time=0,this.skip!=0){this.time=this.attackPattern[this.skip][0],this.currentAttack=this.skip;for(var a=0;a<this.skip/4;a++)a%3==0&&globalGame.player.upgradeShield(),a%3==1&&globalGame.player.upgradeWeapon(),a%3==2&&globalGame.player.upgradeSpeed();}for(var b=0,c=this.enemies;b<c.length;b++){var d=c[b];d.kill(0);}},a.prototype.update=function(d){if(this.time++,this.currentAttack<this.attackPattern.length){var e=this.attackPattern[this.currentAttack][0];this.time>=e&&(this.spawn(this.attackPattern[this.currentAttack][1],this.attackPattern[this.currentAttack][2]),this.currentAttack++);}else this.currentAttack=0,this.time=-500;for(var b=0,c=this.enemies;b<c.length;b++){var a=c[b];a.update(this.time),a.updateHideAfter(),a.hp>0&&Game.spritesIntersect(a.sprite,d.sprite)&&d.takeDamage(1)&&a.takeDamage(1);}},a.prototype.getDeadEnemy=function(){for(var a=0,b=this.enemies;a<b.length;a++){var c=b[a];if(c.sprite.visible==0)return c;}var d=new Enemy(this.engine);return this.enemies.push(d),d;},a.prototype.spawn=function(b,c){var a=this.getDeadEnemy();a.spawn(b,ATTACK_VECTORS[c]);},a;}();var Starfield=function(){function a(b){this.stars=[],this.game=b;for(var c=0;c<100;c++){var a=b.engine.createSprite(Math.random()*b.engine.getWidth(),Math.random()*b.engine.getHeight());this.stars.push(a),a.srcX=192,a.srcY=0,a.width=64,a.height=64,a.alpha=0.2+Math.random()*0.8,a.scale=a.alpha;}}return a.prototype.update=function(){for(var b=0,c=this.stars;b<c.length;b++){var a=c[b];a.pos.x-=a.alpha*2,a.pos.x<0&&(a.pos.x=this.game.engine.getWidth()+a.width,a.pos.y=Math.random()*this.game.engine.getHeight());}},a;}();var Explosion=function(){function a(){}return a.prototype.setData=function(a,b,c,d,e,f){this.lifetime=a,this.x=b,this.y=c,this.width=d,this.height=e,this.intensity=f;},a.prototype.update=function(b){if(this.lifetime<0)return;this.lifetime--;for(var a=0;a<this.intensity;a++)b.spawn(this.x-this.width/2+Math.random()*this.width,this.y-this.height/2+Math.random()*this.height,0,0.1,20,PARTICLE_EXPLO);},a;}();var ExplosionManager=function(){function a(){this.explosions=[];}return a.prototype.explode=function(b,c,d,e,f,g){globalGame.playExplosionSound();var a=this.getFirstDead();a==null&&(a=new Explosion(),this.explosions.push(a)),a.setData(b,c,d,e,f,g);},a.prototype.getFirstDead=function(){for(var a=0,b=this.explosions;a<b.length;a++){var c=b[a];if(c.lifetime<=0)return c;}return null;},a.prototype.update=function(d){for(var a=0,b=this.explosions;a<b.length;a++){var c=b[a];c.update(d);}},a;}();var globalGame=null;var GOODIE_WEAPON=0;var GOODIE_SPEED=1;var GOODIE_SHIELD=2;var GOODIE_POINTS=3;var Goodie=function(a){function b(){return a!==null&&a.apply(this,arguments)||this;}return __extends(b,a),b;}(Sprite);var GoodieManager=function(){function a(){this.goodies=[],this.reset();}return a.prototype.reset=function(){this.goodieCount=0;for(var a=0,b=this.goodies;a<b.length;a++){var c=b[a];c.visible=!1;}},a.prototype.update=function(e,b){for(var c=0,d=this.goodies;c<d.length;c++){var a=d[c];a.visible&&(a.pos.x-=3,e%15==0&&(e%30==0?this.setFrame(a,a.type+1):this.setFrame(a,0)),Game.spritesIntersect(b.sprite,a)&&(a.visible=!1,a.type==GOODIE_WEAPON&&b.upgradeWeapon(),a.type==GOODIE_SHIELD&&b.upgradeShield(),a.type==GOODIE_SPEED&&b.upgradeSpeed(),a.type==GOODIE_POINTS&&b.givePoints(100)));}},a.prototype.getFirstDead=function(){for(var a=0,b=this.goodies;a<b.length;a++){var c=b[a];if(!c.visible)return c;}return null;},a.prototype.setFrame=function(a,b){a.srcX=448,a.srcY=b*64;},a.prototype.spawn=function(c,d,b){globalGame.player.shield&&b==GOODIE_SHIELD&&(b=GOODIE_POINTS),globalGame.player.weaponUpgrade>9&&b==GOODIE_WEAPON&&(b=GOODIE_POINTS),globalGame.player.speedUpgrade>2&&b==GOODIE_SPEED&&(b=GOODIE_POINTS);var a=this.getFirstDead();a==null&&(a=new Goodie(c,d),this.goodies.push(a),globalGame.engine.sprites.push(a),a.width=64,a.height=64),a.visible=!0,a.pos.x=c,a.pos.y=d,a.type=b,this.setFrame(a,0);},a.prototype.dropGoodie=function(a,b,c){(a==ENEMY_TYPE_UFO_BLUE||a==ENEMY_TYPE_SHOOTER_BLUE||a==ENEMY_TYPE_DIAMOND_BLUE)&&(this.goodieCount++,this.spawn(b,c,this.goodieCount%3));},a;}();var Game=function(){function a(a){globalGame=this,this.engine=a,this.gameObjects=[],this.bulletManager=new BulletManager(this),this.starfield=new Starfield(this),this.particles=new ParticleManager(this),this.player=new Player(this.engine,0,0),this.enemyManager=new EnemyManager(a,this.gameObjects),this.explosionManager=new ExplosionManager(),this.goodieManager=new GoodieManager(),this.needHintMove=!0,this.needHintShoot=!0,this.waitForSpaceKey=!1,this.showLogo=!1;}return a.prototype.initialize=function(){this.logo=new Logo(this.engine),this.logo.show(this.engine),this.gameObjects.push(this.player),this.speak('lost in space - by j. p. preesents for j. s. 13 k. games');},a.prototype.speak=function(b){if(window.location.href.indexOf('silent')>-1)return;var a=new SpeechSynthesisUtterance();a.volume=0.6,a.rate=1.2,a.pitch=2,a.text=b,a.lang='en-US',window.speechSynthesis.speak(a);},a.prototype.update=function(a){this.engine.drawCanvasCtx.font='48px arial',this.engine.drawCanvasCtx.fillStyle='white',this.engine.drawCanvasCtx.textAlign='right',this.engine.drawCanvasCtx.fillText(''+this.player.points,1870,50,300),this.player.bestPoints>0&&(this.engine.drawCanvasCtx.font='24px arial',this.engine.drawCanvasCtx.fillText('top score: '+this.player.bestPoints,1870,100,300)),(this.needHintShoot||this.needHintMove)&&(this.engine.drawCanvasCtx.textAlign='center',this.engine.drawCanvasCtx.fillText('cursor keys to move & space key to shoot',960,1000,1000)),this.starfield.update(),this.explosionManager.update(this.particles),this.particles.update(a),this.goodieManager.update(a,this.player);for(var c=0,e=this.gameObjects;c<e.length;c++){var b=e[c];b.updateHideAfter();}if(this.player.hp>0&&this.particles.spawn(this.player.sprite.pos.x-50,this.player.sprite.pos.y,-1-Math.random(),0.8-Math.random()*1.6,55,PARTICLE_BLUE),this.showLogo){if(!this.logo.blendIn())return;this.showLogo=!1,this.waitForSpaceKey=!0;}if(this.waitForSpaceKey){this.engine.isKeyDown(KEY_SPACE)&&(this.waitForSpaceKey=!1,this.player.reset(),this.enemyManager.reset(),this.goodieManager.reset(),this.bulletManager.reset());return;}if(!this.logo.hide())return;this.player.hp<=0&&(this.logo.show(this.engine),this.logo.sprite.alpha=0,this.logo.setToRestart(),this.showLogo=!0),this.enemyManager.update(this.player),this.engine.isKeyDown(KEY_DOWN)&&(this.player.speed.y+=1+this.player.speedUpgrade,this.needHintMove=!1),this.engine.isKeyDown(KEY_UP)&&(this.player.speed.y-=1+this.player.speedUpgrade,this.needHintMove=!1),this.engine.isKeyDown(KEY_LEFT)&&(this.player.speed.x-=1+this.player.speedUpgrade,this.needHintMove=!1),this.engine.isKeyDown(KEY_RIGHT)&&(this.player.speed.x+=1+this.player.speedUpgrade,this.needHintMove=!1),this.engine.isKeyDown(KEY_SPACE)&&(this.player.shoot(a,this.bulletManager),this.needHintShoot=!1),this.player.speed.y*=0.9,this.player.speed.x*=0.9;for(var d=0,f=this.gameObjects;d<f.length;d++){var b=f[d];b.update(a);}this.bulletManager.update(a,this.enemyManager,this.player);},a.spritesIntersect=function(a,b){return a.pos.x+a.width-1>=b.pos.x&&a.pos.x<=b.pos.x+b.width-1&&a.pos.y+a.height-1>=b.pos.y&&a.pos.y<=b.pos.y+b.height-1;},a.prototype.playShotSound=function(){if(navigator.userAgent.indexOf('Firefox')!=-1||navigator.userAgent.indexOf('Edge')!=-1)return;this.context==null&&(this.context=new AudioContext());var a=this.context.createOscillator();var b=this.context.createGain();a.connect(b),a.type='sine',b.connect(this.context.destination),a.frequency.value=1040,a.frequency.linearRampToValueAtTime(240,this.context.currentTime+0.2),a.start(0),b.gain.value=0.1,b.gain.exponentialRampToValueAtTime(0.0001,this.context.currentTime+0.4),a.stop(this.context.currentTime+0.5);},a.prototype.playExplosionSound=function(){if(navigator.userAgent.indexOf('Firefox')!=-1||navigator.userAgent.indexOf('Edge')!=-1)return;this.context==null&&(this.context=new AudioContext());var a=this.context.createOscillator();var b=this.context.createGain();a.connect(b),a.type='sawtooth',b.connect(this.context.destination),a.frequency.value=340,a.frequency.linearRampToValueAtTime(10,this.context.currentTime+0.2),a.start(0),b.gain.value=0.2,b.gain.exponentialRampToValueAtTime(0.0001,this.context.currentTime+0.4),a.stop(this.context.currentTime+0.5);},a.distnaceCheck=function(b,c,f){if(a.spritesIntersect(b,c)){var d=b.pos.x-c.pos.x;var e=b.pos.y-c.pos.y;return Math.sqrt(Math.pow(d,2)+Math.pow(e,2))<f;}return!1;},a;}();